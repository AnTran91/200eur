!function(window,$,qq){window.FineUploader=function(e){this.settings=$.extend({$wrapper:null,element:document.getElementById("js-fine-uploader-gallery"),template:"qq-template-gallery",extra_buttons_element:document.getElementById("fine-uploader-folders"),translations:[],init_url:"/uploader/init",upload_url:"/uploader/upload",chunking_url:"/uploader/chunking",delete_url:"/uploader/delete"},e),this.galleryUploader=new qq.FineUploader({debug:!1,element:this.settings.element,template:this.settings.template,session:{endpoint:this.settings.init_url},request:{endpoint:this.settings.upload_url,requireSuccessJson:!0},messages:{emptyError:this.settings.translations.emptyerror,minSizeError:this.settings.translations.minsizeerror,noFilesError:this.settings.translations.nofileserror,onLeave:this.settings.translations.onLeave,retryFailTooManyItemsError:this.settings.translations.retryfailtoomanyitemserror,sizeError:this.settings.translations.sizeerror,tooManyItemsError:this.settings.translations.toomanyitemserror,typeError:this.settings.translations.typeerror,unsupportedBrowserIos8Safari:this.settings.translations.unsupportedbrowserios8safari},deleteFile:{enabled:!0,method:"POST",endpoint:this.settings.delete_url,forceConfirm:!0},chunking:{enabled:!0,concurrent:{enabled:!0},success:{endpoint:this.settings.chunking_url}},resume:{enabled:!0},retry:{enableAuto:!0,maxAutoAttempts:3,showButton:!0},validation:{allowedExtensions:this.settings.translations.allowedextensions,itemLimit:this.settings.translations.itemlimit,sizeLimit:this.settings.translations.sizelimit},showMessage:this.showMessage.bind(this),showPrompt:this.showPrompt.bind(this),showConfirm:this.showConfirm.bind(this),callbacks:{onComplete:this.onComplete,onSessionRequestComplete:this.onSessionRequestComplete,onDeleteComplete:this.onDeleteComplete}}),this.settings.$wrapper.on("click",".qq-upload-toggle-all-selector",this.handleCheckAllPicture.bind(this)),this.settings.$wrapper.on("click",".js-delete-one-picture",this.deleteOnePicture.bind(this)),this.settings.$wrapper.on("click",".qq-upload-delete-all-selector",this.deleteAll.bind(this))},$.extend(window.FineUploader.prototype,{handleCheckAllPicture:function(e){e.preventDefault(),this.settings.$wrapper.find(".js-checkbox-uploader").each(function(){$(this).is(":checked")?$(this).prop("checked",!1):$(this).prop("checked",!0)})},deleteAll:function(e){var t=this,s=$.map(this.settings.$wrapper.find(".js-checkbox-uploader"),function(e){return e.value});s.length>0&&alertify.confirm(this.settings.translations.confirm,this.settings.translations.multipledeletemsg,function(){t.multipleDelete(s)},function(){console.log("nope")}).set("labels",{ok:this.settings.translations.ok,cancel:this.settings.translations.cancel})},deleteOnePicture:function(e){var t=this;alertify.confirm(this.settings.translations.confirm,this.settings.translations.deletemsg,function(){t.SingleDelete($(e.currentTarget).data("uuid"),$(e.currentTarget).data("id")),$(document).trigger("ON_DELETE_UPLOADED_FILE",[$(e.currentTarget).data("uuid")])},function(){console.log("nope")}).set("labels",{ok:this.settings.translations.ok,cancel:this.settings.translations.cancel})},SingleDelete:function(uuid,id){var self=this;$.ajax({url:self.settings.delete_url,method:"POST",data:{qquuid:uuid},cache:!0,beforeSend:function(){$(self.galleryUploader.getItemByFileId(id)).find(".qq-upload-spinner-selector").removeClass("qq-hide")},success:function(e){e.success?(alertify.success(e.msg,5),qq(self.galleryUploader.getItemByFileId(id)).remove()):alertify.error(e.msg.join("</br>"),5)},error:function(xhr,status,error){var json=eval("("+XMLHttpRequest.responseText+")");alertify.error(json.error,5),$(self.galleryUploader.getItemByFileId(id)).find(".qq-upload-spinner-selector").removeClass("qq-hide")}})},multipleDelete:function(uuids){var self=this;$.ajax({url:self.settings.mutiple_delete_url,method:"DELETE",data:{qqmultipleuuid:uuids},cache:!0,beforeSend:function(){self.settings.$wrapper.find(".js-checkbox-uploader:checked").each(function(){$(self.galleryUploader.getItemByFileId($(this).data("id"))).find(".qq-upload-spinner-selector").removeClass("qq-hide")})},success:function(e){e.success?(alertify.success(e.msg,5),self.settings.$wrapper.find(".js-checkbox-uploader:checked").each(function(){qq(self.galleryUploader.getItemByFileId($(this).data("id"))).remove(),$(document).trigger("ON_DELETE_UPLOADED_FILE",[$(this).val()])})):alertify.error(e.msg.join("</br>"),5)},error:function(xhr,status,error){self.settings.$wrapper.find(".js-checkbox-uploader:checked").each(function(){$(self.galleryUploader.getItemByFileId($(this).data("id"))).find(".qq-upload-spinner-selector").addClass("qq-hide")});var json=eval("("+XMLHttpRequest.responseText+")");alertify.error(json.error,5)}})},showMessage:function(e){return alertify.alert(this.settings.translations.confirm,e)},showPrompt:function(e,t){var s;return s=new qq.Promise,alertify.prompt(this.settings.translations.confirm,e,function(e,t){return s.success(t)},function(){return s.failure(inStr)}).set("labels",{ok:this.settings.translations.ok,cancel:this.settings.translations.cancel}),s},showConfirm:function(e){var t;return t=new qq.Promise,alertify.confirm(this.settings.translations.confirm,this.settings.translations.deletemsg,function(){return t.success()},function(){return t.failure()}).set("labels",{ok:this.settings.translations.ok,cancel:this.settings.translations.cancel}),t},onComplete:function(e,t,s,i){if(s.success){alertify.success(s.msg,5);var n=qq(this.getItemByFileId(e)).getByClass("js-checkbox-uploader")[0];n.setAttribute("value",s.newUuid),n.setAttribute("data-id",e),$(document).trigger("ON_UPLOAD_FILE",[e,s.newUuid])}else alertify.error(s.error,5)},onSessionRequestComplete:function(e,t,s){if(t){var i=this;$(e).each(function(e,t){var s=qq(i.getItemByFileId(e)).getByClass("js-checkbox-uploader")[0];s.setAttribute("value",t.uuid),s.setAttribute("data-id",e);var n=qq(i.getItemByFileId(e)).getByClass("js-retouchs-list-group")[0];$(t.retouch).each(function(e,t){var s=document.createElement("span"),i=document.createElement("a"),r=document.createTextNode(" "+t.title.toUpperCase()),o=document.createElement("i");o.setAttribute("class","fas fa-tag"),i.appendChild(o),i.appendChild(r),i.setAttribute("href","#"),s.appendChild(i),s.setAttribute("class","tag"),n.appendChild(s)}),$(document).trigger("ON_UPLOAD_FILE",[e,t.uuid])})}},onDeleteComplete:function(id,xhr,isError){if(isError)alertify.notify(responseJSON.msg,"error",5);else{var responseJSON=eval("("+xhr.responseText+")");alertify.notify(responseJSON.msg,"success",5),$(document).trigger("ON_DELETE_UPLOADED_FILE",[responseJSON.uuid])}}})}(window,jQuery,qq);