!function(window,jQuery){window.Uploader=function(e,a){this.$wrapper=e,this.options=$.extend({new_picture_form_url:null,param_list_url:null,new_param_form_url:null},a),this.$wrapper.on("change","#js-picture-retouch input",this.updatePictureRetouch.bind(this)),this.$wrapper.on("click","#js-next-step",this.validateCurrentStep.bind(this)),this.$wrapper.on("click",".js-collapse-params",this.handleCollapsibleArea.bind(this)),this.$wrapper.on("change",".js-checkbox-uploader",this.handlePictureCheck.bind(this)),this.$wrapper.on("click",".js-check-all-uploader",this.handleCheckAllPicture.bind(this)),this.$wrapper.on("change",'input[type="file"]',this.handleImagePreview.bind(this)),this.$wrapper.on("click",".js-clear-input-file",this.clearInputFile.bind(this)),this.$wrapper.on("click",".js-placement-button",this.handlePlacement.bind(this)),this.$wrapper.on("show.bs.collapse",".accordion",this.handleRetouchCollapse.bind(this)),this.$wrapper.on("submit",".js-picture-detail",this.handleParamFormSubmit.bind(this)),this.$wrapper.on("show.bs.collapse",".js-param-toggle",this.paramShowCollapse.bind(this)),this.$wrapper.on("hide.bs.collapse",".js-param-toggle",this.paramHideCollapse.bind(this)),this.$wrapper.on("change","[data-onchange] input",this.onChangeParamFields.bind(this)),this.$wrapper.on("change",".js-renovation-choices",this.handleImagePicker.bind(this)),this.$wrapper.on("focus blur change",".js-picture-detail",this.onChangeParamFormFields.bind(this)),this.$wrapper.on("click",".js-delete-file",this.onDeleteParamFile.bind(this)),$(document).on("ON_UPLOAD_FILE",{},this.onUploadFile.bind(this)),$(document).on("ON_DELETE_UPLOADED_FILE",{},this.onDeleteFile.bind(this)),this.$wrapper.find(".js-picture-settings input").prop("disabled",!0).addClass("disabled"),this.$wrapper.find('[data-toggle="popover"]').popover()},$.extend(window.Uploader.prototype,{onDeleteParamFile:function(e){e.preventDefault(),$.ajax({url:$(e.currentTarget).data("href"),data:{_token:$(e.currentTarget).data("token"),file_path:$(e.currentTarget).data("file")},method:"POST",success:function(a){a.success?($(e.currentTarget).closest(".fileuploader-items").remove(),alertify.success(a.msg,5)):alertify.error(a.msg,5)},error:function(XMLHttpRequest,textStatus,errorThrown){var json=eval("("+XMLHttpRequest.responseText+")");alertify.error(textStatus,5)}})},onChangeParamFormFields:function(e){$(e.currentTarget).find(".js-retouch-form:checked").fieldValue().length>0?$(e.currentTarget).find(".js-save-settings").prop("disabled",!1):$(e.currentTarget).find(".js-save-settings").prop("disabled",!0)},onChangeParamFields:function(e){var a=$(e.currentTarget).closest(".accordion-content");$(e.currentTarget).val()!=$(e.currentTarget).closest("[data-onchange]").data("value")?(console.log("disabled false"),a.find('[data-dependon="'+$(e.currentTarget).closest("[data-onchange]").data("onchange")+'"]').prop("disabled",!1),a.find('[data-dependon="'+$(e.currentTarget).closest("[data-onchange]").data("onchange")+'"] input').prop("disabled",!1)):(console.log("disabled true"),a.find('[data-dependon="'+$(e.currentTarget).closest("[data-onchange]").data("onchange")+'"]').prop("disabled",!0),a.find('[data-dependon="'+$(e.currentTarget).closest("[data-onchange]").data("onchange")+'"] input').prop("disabled",!0))},paramShowCollapse:function(e){var a=$(e.currentTarget).find("i.fas");a.removeClass("fa-angle-right"),a.addClass("fa-angle-down"),console.log("show")},paramHideCollapse:function(e){var a=$(e.currentTarget).find("i.fas");a.removeClass("fa-angle-down"),a.addClass("fa-angle-right"),console.log("hide")},onUploadFile:function(event,id,picture_id){var self=this;$.ajax({url:Routing.generate(this.options.new_picture_form_url,{id:picture_id}),data:{id:id},method:"GET",success:function(e){self.$wrapper.find(".js-pictrue-detail-section").append(e),self.initHtml()},error:function(XMLHttpRequest,textStatus,errorThrown){var json=eval("("+XMLHttpRequest.responseText+")");alertify.error(textStatus,5)}})},onDeleteFile:function(e,a){$("#js-uuid-"+a).remove()},handlePlacement:function(e){var a=$(e.currentTarget).parents("div .js-placement-list");a.find(":input").is(":disabled")||(a.find(".pink-r-button").removeClass("pink-r-button"),a.find(":input").val($(e.currentTarget).data("value")),$(e.currentTarget).addClass("pink-r-button"))},handleRetouchCollapse:function(e){this.updateParamsForm($(e.currentTarget).data("uuid"),$(e.currentTarget).data("id"),$(e.currentTarget).find(".accordion-content"))},clearInputFile:function(e){e.preventDefault();var a=$(e.currentTarget).closest(".fileuploader-items").closest(".image-uploader-ctn").find('input[type="file"]');$(e.currentTarget).closest(".fileuploader-items").remove(),console.log(a),a.val("");var t=a.parents(".js-param-col").next().find(".js-img-preview");console.log(t),console.log(a.data("default")),t.attr("src",a.data("default"))},handleImagePreview:function(e){var a=$(e.currentTarget)[0].files[0];$(e.currentTarget).parents(".js-param-col").find(".fileuploader-items").length>0&&$(e.currentTarget).parents(".js-param-col").find(".fileuploader-items").empty(),$(e.currentTarget).parents(".js-param-col").find(".image-uploader-ctn").append('<div class="fileuploader-items">\n            <ul class="fileuploader-items-list">\n                <li class="fileuploader-item file-has-popup file-type-image file-ext-png">\n                    <div class="columns">\n                        <div class="column-thumbnail">\n                            <div class="fileuploader-item-image fileuploader-no-thumbnail">\n                                <div style="background-color: #fab6c0" class="fileuploader-item-icon">\n                                    <i>'+a.name.split(".").pop().toUpperCase()+'</i>\n                                </div>\n                            </div>\n                            <span class="fileuploader-action-popup"></span>\n                        </div>\n                        <div class="column-title">\n                            <div title="'+a.name+'">'+a.name+"</div>\n                            <span>"+a.size.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")+' KB</span></div>\n                        <div class="column-actions">\n                            <a href="#" class="fileuploader-action fileuploader-action-remove js-clear-input-file"><i class="fas fa-trash"></i></a>\n                        </div>\n                    </div>\n                    <div class="progress-bar2">\n                        <span></span>\n                    </div>\n                </li>\n            </ul>\n        </div>');var t=$(e.currentTarget).parents(".js-param-col").next().find(".js-img-preview");if($(e.currentTarget)[0]&&$(e.currentTarget)[0].files[0]){var r=new FileReader;r.onload=function(e){t.attr("src",e.target.result)},r.readAsDataURL($(e.currentTarget)[0].files[0])}},handleCollapsibleArea:function(e){"true"==$(e.currentTarget).attr("aria-expanded")?$(e.currentTarget).find("i.fas").removeClass("fa-angle-down").addClass("fa-angle-right"):$(e.currentTarget).find("i.fas").removeClass("fa-angle-right").addClass("fa-angle-down")},handleCheckAllPicture:function(e){e.preventDefault(),this.$wrapper.find(".js-checkbox-uploader").trigger("change")},handlePictureCheck:function(e){e.preventDefault(),0===this.$wrapper.find(".js-checkbox-uploader:checked").fieldValue().length?this.$wrapper.find(".js-picture-settings input").prop("disabled",!0).addClass("disabled"):this.$wrapper.find(".js-picture-settings input").prop("disabled",!1).removeClass("disabled")},updatePictureRetouch:function(e){e.preventDefault();var $form=$(e.currentTarget).closest("form"),$uuid=$(e.currentTarget).closest(".js-picture-detail").data("uuid"),self=this;$.ajax({url:Routing.generate(this.options.param_list_url,{id:$uuid}),method:"POST",data:$form.serialize(),cache:!0,beforeSend:function(){self.$wrapper.find("#js-params-"+$uuid).html('<div class="lt-px-auto-small animated fadeIn"><div class="partial-loader"></div></div>')},success:function(e){self.$wrapper.find("#js-params-"+$uuid).html(e),self.$wrapper.find("#js-params-"+$uuid).closest(".js-picture-detail").find("#js-save-setting-icon").removeClass("fas fa-check-circle"),self.initHtml()},error:function(XMLHttpRequest,textStatus,errorThrown){var json=eval("("+XMLHttpRequest.responseText+")");alertify.error(json.error,5)}})},getTheDisabledData:function(e){e.find("input:disabled").addClass("disabled"),e.find(".disabled").prop("disabled",!1);var a=e.find(".disabled").serializeArray();return e.find(".disabled").prop("disabled",!0),e.find("input:disabled").removeClass("disabled"),a},handleParamFormSubmit:function(e){e.preventDefault();var a=this,t=$(e.currentTarget).closest("form"),r={};t.ajaxSubmit({forceSync:!0,beforeSend:function(e,a){r=alertify.message('<div class="partial-loader-section"><p class="partial-loader-text">00 %</p><div class="partial-loader"></div></div>',0)},uploadProgress:function(e,a,t,i){r.setContent('<div class="partial-loader-section"><p class="partial-loader-text">'+i+' %</p><div class="partial-loader"></div></div>',0)},data:a.getTheDisabledData(t),success:function(e){if(t.find(".js-save-settings").prop("disabled",!0),t.find("#js-save-setting-icon").addClass("fas fa-check-circle"),alertify.dismissAll(),e.success){alertify.success(e.msg,5).dismissOthers();var r=a.$wrapper.find(".qq-file-id-"+t.data("id")).find(".js-retouchs-list-group");r.empty(),t.find(".js-retouch-form:checked").each(function(e,a){var t=$(a).parent(".js-retouch-checkbox").find(".js-retouch-label").html();r.append('<span class="tag"><a><i class="fas fa-tag"></i> '+t+"</a></span>")}),t.find('input[type="file"]').clearFields()}else if("string"===jQuery.type(e.msg))alertify.error(e.msg,5).dismissOthers();else for(var i in e.msg){var s="";s+="<p>"+i+"</p>";for(var n in e.msg[i]){var l="";n.length>0&&(l=n+" : "),s+="<p>"+l+e.msg[i][n]+"</p>"}alertify.error(s,5)}},error:function(e,a,t){alertify.error(t,5).dismissOthers()}})},handleImagePicker:function(e){$(e.currentTarget).closest(".js-renovation-section").find(".js-renovation-img-thumb").attr("src",$(e.currentTarget).find(":selected").data("img-src"))},initHtml:function(){this.$wrapper.find(".js-disabled-block").each(function(){$(this).parents(".js-param-col").next().find(".js-img-preview").attr("src",$(this).data("src"))}),this.$wrapper.find('input[type="file"]').each(function(){$(this).parents(".js-param-col").next().find(".js-img-preview").attr("src",$(this).data("src"))}),this.$wrapper.find(".js-renovation-choices").each(function(){var e=$(this).closest(".js-renovation-section").find(".js-renovation-img-thumb");""!==$(this).find(":selected").data("img-src")&&e.attr("src",$(this).find(":selected").data("img-src"))}),this.$wrapper.find(".js-renovation-choices").imagepicker({hide_select:!0,show_label:!1}),this.$wrapper.find(".js-picture-settings input").prop("disabled",!0).addClass("disabled"),this.$wrapper.find('[data-toggle="popover"]').popover()},updateParamsForm:function($uuid,$id,$elem){var self=this;0===$elem.children().length&&$.ajax({url:Routing.generate(this.options.new_param_form_url,{uuid:$uuid,id:$id}),method:"GET",cache:!0,beforeSend:function(){$elem.html('<div class="lt-px-auto-small animated fadeIn"><div class="partial-loader"></div></div>')},success:function(e){$elem.html(e),self.initHtml()},error:function(xhr,status,error){var json=eval("("+XMLHttpRequest.responseText+")");alertify.error(json.error,5)}})},handlePictureDelete:function(e){var a=$(e.currentTarget).data("id");this.galleryUploader.deleteFile(a)},validateCurrentStep:function(e){e.preventDefault();var a=$(e.currentTarget).data("msg"),t=!0;$(".js-picture-detail").each(function(e){console.log($(this).find(".js-retouch-form:checked").val()),void 0!==$(this).find(".js-retouch-form:checked").val()&&null!==$(this).find(".js-retouch-form:checked").val()&&void 0!==$(this).find("#js-save-setting-icon").prop("class")&&""!==$(this).find("#js-save-setting-icon").prop("class")||(alertify.error(a+" "+$(this).data("picture-name"),5),t=!1)}),t&&window.location.assign($(e.currentTarget).data("href"))}})}(window,jQuery);