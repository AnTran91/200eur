!function(e,t,i){e.Promo=function(e){this.$wrapper=e,this.$wrapper.on("click","#js-promo-code-secure",this.generateUuid.bind(this)),this.$wrapper.on("change",".js-update-the-form",this.onChange.bind(this)),this.$wrapper.on("change",".js-promo-type",this.onChange.bind(this)),this.init.bind(this),this.init()},$.extend(e.Promo.prototype,{generateUuid:function(e){$(e.currentTarget).closest(".input-group").find('input[type="text"]').val(this.uuid())},uuid:function(){new Date;return"Cxxxxxxxxxxxx4xxx".replace(/[xy]/g,function(e){var t=16*i.random()|0;return("x"===e?t:3&t|8).toString(16)})+"-T"+moment().format("DDMMYYYY")},init:function(){this.$wrapper.find(".js-datepicker").each(function(){$(this).datetimepicker({locale:"fr",format:"L"})}),this.$wrapper.find(".js-select").length>0&&this.$wrapper.find(".js-select").each(function(){$(this).selectize()}),this.$wrapper.find(".js-collection").length>0&&this.$wrapper.find(".js-collection").collection({allow_up:!1,allow_down:!1,add_at_the_end:!0,min:1})},handleSubmit:function(e){var t=this;$.ajax({url:e.attr("action"),method:e.attr("method"),data:e.serializeArray(),beforeSend:function(){t.$wrapper.find(".card-body").css("opacity","0.2"),t.$wrapper.find(".card-body").append('<div class="loader"></div>')},success:function(e){var i=$(e).find(".card-body");i.find(".form-group").removeClass("is-invalid"),i.find(".form-control").removeClass("is-invalid"),i.find(".form-group").each(function(){$(this).find(".invalid-feedback").remove()}),t.$wrapper.find(".card-body").replaceWith(i),t.init()},error:function(e,i,r){t.$wrapper.find(".card-body").css("opacity","1"),t.$wrapper.find(".card-body .loader").remove(),alertify.error("something went wrong sorry about that. please try again later.",5)}})},onChange:function(e){e.preventDefault(),this.handleSubmit($(e.currentTarget).closest("form"))}})}(window,jQuery,Math);
