!function(e,i){e.ChunkedFileUploader=function(e){this.settings=i.extend({$wrapper:null,slice_size:"",file_uuid:"ec05c3f8-7ee4-493f-97ae-045b08cd980c",chunking_url:"/uploader/chunking",method:"POST"},e),this.reader={},this.image={},this.index={},this.uploadUuid=this.settings.file_uuid,this.$wrapper=this.settings.$wrapper,this.slice_size=1024e3,this.chunking_url=this.settings.chunking_url,this.method=this.settings.method,i(document).on("ON_UPLOAD_FILE",{},this.fileUploader.bind(this))},i.extend(e.ChunkedFileUploader.prototype,{fileUploader:function(e,t){e.preventDefault();var s=new FileReader,a=t,n=0,r=0,l=this,u=!1,c=alertify.success('<i class="fas fa-spinner fa-spin p-1 float-right"></i>0%');c.ondismiss=function(){return u},function e(t){var d=t+l.slice_size+1;var o=a.asBlob();var h=o.slice(t,d);var f=Math.ceil(o.size/l.slice_size);s.onloadend=function(p){p.target.readyState===FileReader.DONE&&i.ajax({url:l.chunking_url,type:l.method,cache:!1,async:!0,data:{metadata:JSON.stringify({fileName:a.suggestedFileName(),chunkIndex:n,uploadUid:l.uploadUuid,totalChunks:f,totalSize:h.size}),base64:p.target.result},error:function(e,i,t){r++<=3?s.readAsDataURL(h):c.dismiss()},success:function(i){n+=1;var s=t+l.slice_size,a=Math.floor(s/o.size*100);d<o.size?(c.setContent('<i class="fas fa-spinner fa-spin p-1 float-right"></i>'+a+"%"),e(d)):(c.setContent('<i class="fas fa-check-circle p-1 float-right"></i> 100%'),u=!0)}})};s.readAsDataURL(h)}(n)}})}(window,jQuery);
