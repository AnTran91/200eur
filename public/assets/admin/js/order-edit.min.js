!function(e,t,a){e.Order=function(e,a){this.$wrapper=e,this.deliveryTimeID=a,this.$wrapper.find(".js-file-upload").each(this.uploadImg),this.$wrapper.on("change",".js-retouch-options",this.updatePrice.bind(this)),this.$wrapper.on("change",".js-retouch-options",this.updateTitle.bind(this)),this.$wrapper.on("click",".js-picture-detail-param",this.showParams.bind(this)),$(document).on("change",".js-renovation-choices",this.handleImagePicker.bind(this)),$(document).on("change",'input[type="file"]',this.handleImagePreview.bind(this)),$(document).on("change","[data-onchange] input",this.onChangeParamFields.bind(this)),$(document).on("click",".js-placement-button",this.handlePlacement.bind(this)),t.genericDialog||t.dialog("genericDialog",this.genericDialog.bind(this)),this.$wrapper.find(".js-pictures-collection").collection({prefix:"pictures",allow_up:!1,allow_down:!1,children:[{selector:".js-child-collection",prefix:"picture-detail",allow_up:!1,allow_down:!1,add_at_the_end:!0,add:'<a class="mt-5 btn btn-icon btn-dark float-right" href="#"><span class="fas fa-plus"></span></a>',min:1,after_add:function(e,t){$(t).find(".js-retouch-options").trigger("change");var a=$(t).find(".js-disabled-file-upload");a.kendoUpload({multiple:!1,localization:{select:a.data("label")}}),a.data("kendoUpload").disable()},after_remove:function(e,a){void 0!==$(a).data("id")&&$.ajax({url:$(a).data("href"),method:"DELETE",data:{data:$(a).data("id"),_token:$(a).data("token")},success:function(e){e.success?t.success(e.msg):t.error(e.msg)},error:function(e,a,i){t.error("something went wrong sorry about that. please try again later.",5)}})}}]})},$.extend(e.Order.prototype,{genericDialog:function(){var e=this;return{main:function(e){return this.setContent(e),this},hooks:{onshow:function(){var e=$(this.elements.body.querySelector("form"));e.submit(function(i){i.preventDefault();var n={};e.ajaxSubmit({forceSync:!0,beforeSend:function(e,a){n=t.message('<div class="partial-loader-section"><div class="partial-loader"></div><p class="partial-loader-text">00%</p></div>',0)},uploadProgress:function(e,t,a,i){n.setContent('<div class="partial-loader-section"><div class="partial-loader"></div><p class="partial-loader-text">'+i+" %</p></div>",0)},data:function(){e.find("input:disabled").addClass("disabled"),e.find(".disabled").prop("disabled",!1);var t=e.find(".disabled").serializeArray();return e.find(".disabled").prop("disabled",!0),e.find("input:disabled").removeClass("disabled"),t},success:function(e){if(t.dismissAll(),e.success)t.success(e.msg,5).dismissOthers();else if("string"===a.type(e.msg))t.error(e.msg,5).dismissOthers();else for(var i in e.msg){var n="";for(var s in n+="<p>"+i+"</p>",e.msg[i]){var r="";s.length>0&&(r=s+" : "),n+="<p>"+r+e.msg[i][s]+"</p>"}t.error(n)}},error:function(e,a,i){t.error(i,5).dismissOthers()}})}),$(this.elements.body).find(".js-disabled-block").each(function(){$(this).parents(".js-param-col").next().find(".js-img-preview").attr("src",$(this).data("src"))}),$(this.elements.body).find('input[type="file"]').each(function(){$(this).parents(".js-param-col").next().find(".js-img-preview").attr("src",$(this).data("src"))}),$(this.elements.body).find(".js-renovation-choices").each(function(){var e=$(this).closest(".js-renovation-section").find(".js-renovation-img-thumb");""!==$(this).find(":selected").data("img-src")&&e.attr("src",$(this).find(":selected").data("img-src"))}),$(this.elements.body).find(".js-renovation-choices").imagepicker({hide_select:!0,show_label:!1}),$(this.elements.body).find(".js-picture-settings input").prop("disabled",!0).addClass("disabled"),$(this.elements.body).find('[data-toggle="popover"]').popover()},onclose:function(){console.log("onclose")},onupdate:function(){console.log("onupdate")}},setup:function(){return{focus:{element:function(){return this.elements.body.querySelector(this.get("selector"))},select:!0},prepare:function(){e.initHtml(this.elements.body)},options:{basic:!0,resizable:!1,startMaximized:!0,transition:"zoom"}}},settings:{selector:void 0}}},handleImagePreview:function(e){var t=$(e.currentTarget).parents(".js-param-col").next().find(".js-img-preview");if(0===t.length&&$(e.currentTarget).parents(".js-param-col").find(".js-file-label").html($(e.currentTarget)[0].files[0].name),$(e.currentTarget)[0]&&$(e.currentTarget)[0].files[0]){var a=new FileReader;a.onload=function(e){t.attr("src",e.target.result)},a.readAsDataURL($(e.currentTarget)[0].files[0])}},handlePlacement:function(e){var t=$(e.currentTarget).parents("div .js-placement-list");t.find(":input").is(":disabled")||(t.find(".pink-r-button").removeClass("pink-r-button"),t.find(":input").val($(e.currentTarget).data("value")),$(e.currentTarget).addClass("pink-r-button"))},onChangeParamFields:function(e){var t=$(e.currentTarget).closest("form");$(e.currentTarget).val()!=$(e.currentTarget).closest("[data-onchange]").data("value")?(t.find('[data-dependon="'+$(e.currentTarget).closest("[data-onchange]").data("onchange")+'"]').prop("disabled",!1),t.find('[data-dependon="'+$(e.currentTarget).closest("[data-onchange]").data("onchange")+'"] input').prop("disabled",!1)):(t.find('[data-dependon="'+$(e.currentTarget).closest("[data-onchange]").data("onchange")+'"]').prop("disabled",!0),t.find('[data-dependon="'+$(e.currentTarget).closest("[data-onchange]").data("onchange")+'"] input').prop("disabled",!0))},showParams:function(e){e.preventDefault();var a={},i=$(e.currentTarget).closest(".js-picture-detail-section").find("select option:selected");console.log(i.val());var n=$(e.currentTarget).data("picture-detail-id");void 0===n&&(n=$($(".js-picture-detail-param")[0]).data("picture-detail-id")),$.ajax({url:Routing.generate("admin_render_param_form",{id_picture_detail:n,id_retouch:i.val()}),method:"GET",async:!1,cache:!0,beforeSend:function(e,i){a=t.message('<div class="partial-loader"></div>',0)},success:function(e){a.dismiss(),t.genericDialog(e).set("selector","form")},error:function(e,i,n){a.dismiss(),t.error("something went wrong sorry about that. please try again later.",5)}})},updatePrice:function(e){var t=0;t=$(e.currentTarget).find("option:selected")[0].hasAttribute("data-standard")?$(e.currentTarget).find("option:selected").data("standard"):$(e.currentTarget).find("option:selected").data(this.deliveryTimeID),$(e.currentTarget).closest(".js-picture-detail-section").find(".js-retouch-price").val(parseFloat(t).toFixed(2))},updateTitle:function(e){var t=$(e.currentTarget).find("option:selected").text();$(e.currentTarget).closest("div.card").find(".card-header > h3.card-title").text(t)},handleImagePicker:function(e){$(e.currentTarget).closest(".js-renovation-section").find(".js-renovation-img-thumb").attr("src",$(e.currentTarget).find(":selected").data("img-src"))},initHtml:function(e){$(e).find(".js-disabled-block").each(function(){$(this).parents(".js-param-col").next().find(".js-img-preview").attr("src",$(this).data("src"))}),$(e).find('input[type="file"]').each(function(){$(this).parents(".js-param-col").next().find(".js-img-preview").attr("src",$(this).data("src"))}),$(e).find(".js-renovation-choices").each(function(){var e=$(this).closest(".js-renovation-section").find(".js-renovation-img-thumb");""!==$(this).find(":selected").data("img-src")&&e.attr("src",$(this).find(":selected").data("img-src"))}),$(e).find(".js-renovation-choices").imagepicker({hide_select:!0,show_label:!1}),$(e).find(".js-picture-settings input").prop("disabled",!0).addClass("disabled"),$(e).find('[data-toggle="popover"]').popover()},uploadImg:function(){$(this).kendoUpload({multiple:!1,async:{chunkSize:$(this).data("chunk-size"),saveUrl:$(this).data("upload-url"),removeUrl:$(this).data("delete-url"),autoUpload:!0},validation:{allowedExtensions:$(this).data("allowed-extensions"),maxFileSize:$(this).data("size-limit")},files:$(this).data("init-files"),localization:{select:$(this).data("label")},success:function(e){"upload"==e.operation&&(e.files[0].name=e.response.fileName,$(this.element).closest(".js-picture-detail-section").find(".k-file-name").html(e.response.fileName),$(this.element).closest(".js-picture-detail-section").find(".js-file-name").val(e.response.fileName));t.success(e.response.msg,5)},error:function(e){t.error(e.response.error,5)}})}})}(window,alertify,jQuery);